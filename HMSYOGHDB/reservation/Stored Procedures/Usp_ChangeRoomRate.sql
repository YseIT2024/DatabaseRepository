CREATE PROCEDURE [reservation].[Usp_ChangeRoomRate](		@dtChangeRate AS [reservation].[dtRoomRateChange] READONLY)ASBEGIN     BEGIN TRANSACTION		DECLARE @tempTable Table(				[ReservationDetailID_] [int],				[AmountBTTax_] [decimal](18, 4))				insert into @tempTable 				select * from  @dtChangeRate				declare @DiscountPer decimal(18,4);				declare @TaxPer decimal(18,4);				declare @RoomCount int;				declare @ReservationID INT;		DECLARE @ReservationDetailID_ INT;		DECLARE @AmountBTTax_ decimal(18,4);		DECLARE myCursor CURSOR FOR select [ReservationDetailID_],[AmountBTTax_] from @tempTable		OPEN myCursor;		FETCH NEXT FROM myCursor INTO @ReservationDetailID_,@AmountBTTax_;		WHILE @@FETCH_STATUS = 0		BEGIN				select 		--@DiscountPer=Discount,		@DiscountPer=isnull(DiscountPercentage,0),		@TaxPer=TotalTax,		@RoomCount=Rooms,		@ReservationID=ReservationID		from reservation.ReservationDetails where ReservationDetailID=@ReservationDetailID_				Update [reservation].[ReservationDetails] SET 				UnitPriceBeforeDiscount=@AmountBTTax_ , 				Discount=(@DiscountPer*@AmountBTTax_)/100,				UnitPriceAfterDiscount=@AmountBTTax_- (@DiscountPer*@AmountBTTax_)/100 ,								TotalTaxAmount=((@AmountBTTax_- (@DiscountPer*@AmountBTTax_)/100)*(@TaxPer/100)),				UnitPriceAfterTax=(@AmountBTTax_- (@DiscountPer*@AmountBTTax_)/100)+((@AmountBTTax_- (@DiscountPer*@AmountBTTax_)/100)*(@TaxPer/100)),				LineTotal=(@AmountBTTax_- (@DiscountPer*@AmountBTTax_)/100)+((@AmountBTTax_- (@DiscountPer*@AmountBTTax_)/100)*(@TaxPer/100)) *@RoomCount				where ReservationDetailID=@ReservationDetailID_;				--(@TaxPer * (( 		FETCH NEXT FROM myCursor INTO @ReservationDetailID_,@AmountBTTax_;		END		CLOSE myCursor;		DEALLOCATE myCursor;		BEGIN			UPDATE [reservation].[Reservation]           SET 		   --TotalAmountBeforeTax= (select sum(r.UnitPriceBeforeDiscount)from [reservation].[ReservationDetails] r where r.ReservationID = @ReservationID),		   TotalAmountBeforeTax=(select Sum(r.LineTotal)-sum(TotalTaxAmount) from [reservation].[ReservationDetails]  r where r.ReservationID = @ReservationID),		   TotalTaxAmount=(select Sum(r.TotalTaxAmount) from [reservation].[ReservationDetails]  r where r.ReservationID = @ReservationID),		   TotalAmountAfterTax=(select Sum(r.LineTotal) from [reservation].[ReservationDetails]  r where r.ReservationID = @ReservationID),		   TotalPayable=(select Sum(r.LineTotal) from [reservation].[ReservationDetails]  r where r.ReservationID = @ReservationID),		   AdditionalDiscountAmount=(select Sum(r.Discount) from [reservation].[ReservationDetails]  r where r.ReservationID = @ReservationID)            WHERE ReservationID = @ReservationID;		END;		SELECT 1 AS IsSuccess, 'Rates Updated successfully' AS Message;		COMMIT TRANSACTION			END;